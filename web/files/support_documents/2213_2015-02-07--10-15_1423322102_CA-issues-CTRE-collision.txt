date:  1/24/15
ticker collision for CTRE   case 2213 

select distinct stockkey from mstockalias where symbol='CTRE';

> Row 1:
>   STOCKKEY = X'b1030141537bdd22c0a86f92'
> Row 2:
>   STOCKKEY = X'969250b9538e573ac0a86f92'


*************************************************************************
> CTRE 1:
>   STOCKKEY = X'b1030141537bdd22c0a86f92'
this started as CTREV and then did a ticker change to CTRE  this has some dividends 
there are only 7 member generated mtickets, and none generated by CA
we're going to move these over to the other stockkey and then delete this 
***************************************************************************
select * from mstockalias where STOCKKEY = X'b1030141537bdd22c0a86f92';
> Row 1:
>   CAPSECTORKEY = NULL
>          CUSIP = 14174T107
>           DATE = TIMESTAMP '2014-05-20 00:00:00.000000'
>    EXCHANGEKEY = X'9d5d2f1d390a440bc0a8015c'
>           NAME = CareTrust REIT Inc
>     PRIMARYKEY = X'b1040141537bdd22c0a86f92'
>       STOCKKEY = X'b1030141537bdd22c0a86f92'
>         SYMBOL = CTREV
>      STATUSKEY = X'634a039339e7e928c0a801dc'
>      CSISYMBOL = NULL
>        GICSKEY = 00000000
>       STYLEKEY = UU
	select * from mcorporateaction where aliaskey=X'b1040141537bdd22c0a86f92';
> Row 1:
>              ALIASKEY = X'b1040141537bdd22c0a86f92'
>   BB_ACTIONDICTIONARY = CP_EXCH|UW|CP_TKR|CTREV|CP_SEC_TYP|1|CP_NOTES|N.A.
>         BB_ACTIONFLAG = N
>           BB_ACTIONID = 91358966
>     BB_ACTIONMNEMONIC = LIST
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-05-20 00:00:00.000000'
>         BB_IDENTIFIER = CTREV   US Equity
>             BB_ISSUED = TIMESTAMP '2014-05-16 00:00:00.000000'
>          BB_NUMFIELDS = 4
>              BB_RCODE = 0
>              BB_SECID = CTREV
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-05-16 00:00:00.000000'
>            PRIMARYKEY = X'041d701653769601c0a86f92'
>               VERSION = NULL

> Row 2:
>   CAPSECTORKEY = NULL
>          CUSIP = 14174T107
>           DATE = TIMESTAMP '2014-06-03 00:00:00.000000'
>    EXCHANGEKEY = X'9d5d2f1d390a440bc0a8015c'
>           NAME = CareTrust REIT Inc
>     PRIMARYKEY = X'94fd4d94538e5520c0a86f92'
>       STOCKKEY = X'b1030141537bdd22c0a86f92'
>         SYMBOL = CTRE
>      STATUSKEY = X'634a039339e7e928c0a801dc'
>      CSISYMBOL = NULL
>        GICSKEY = 40402045
>       STYLEKEY = XG
	select * from mcorporateaction where aliaskey=X'94fd4d94538e5520c0a86f92';
> Row 1:
>              ALIASKEY = X'94fd4d94538e5520c0a86f92'
>   BB_ACTIONDICTIONARY = CP_OLD_TKR|CTREV US|CP_NEW_TKR|CTRE US|CP_NOTES|End of when issued trading
>         BB_ACTIONFLAG = N
>           BB_ACTIONID = 91959168
>     BB_ACTIONMNEMONIC = CHG_TKR
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-06-03 00:00:00.000000'
>         BB_IDENTIFIER = CTREV   US Equity
>             BB_ISSUED = TIMESTAMP '2014-06-02 00:00:00.000000'
>          BB_NUMFIELDS = 3
>              BB_RCODE = 0
>              BB_SECID = CTREV
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-06-02 00:00:00.000000'
>            PRIMARYKEY = X'24296f69538cffb5c0a86f92'
>               VERSION = NULL
> Row 2:
>              ALIASKEY = X'94fd4d94538e5520c0a86f92'
>   BB_ACTIONDICTIONARY = CP_RECORD_DT|20141031|CP_PAY_DT|20141210|CP_FREQ|N.A.|CP_NET_AMT|N.A.|CP_TAX_AMT| |CP_GROSS_AMT|5.88|CP_FRANKED_AMT| |CP_DVD_CRNCY|USD|CP_DVD_TYP|1001|CP_SPPL_AMT| |CP_FOREIGN_AMT|N.A.|CP_PAR_PCT|N.A.|CP_STOCK_OPT|S|CP_REINVEST_RATIO|N.A.|CP_PX|N.A.|CP_TAX_RT|N.A.|CP_ADJ|0.680087|CP_ADJ_DT|20141211|CP_INDICATOR|N|CP_DVD_DRP_DISCOUNT|N.A.|CP_EUSD_TID| |CP_EUSD_TID_SW| |CP_DIST_AMT_STATUS|L|CP_NOTES|The amount of cash distributed will be approximately $33.0 million, with the remainder distributed in shares
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 97615869
>     BB_ACTIONMNEMONIC = DVD_CASH
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-12-11 00:00:00.000000'
>         BB_IDENTIFIER = CTRE    US Equity
>             BB_ISSUED = TIMESTAMP '2014-10-17 00:00:00.000000'
>          BB_NUMFIELDS = 24
>              BB_RCODE = 0
>              BB_SECID = CTRE
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-12-11 00:00:00.000000'
>            PRIMARYKEY = X'265b1618548a3074c0a86f92'
>               VERSION = NULL
update mcorporateaction set ALIASKEY = X'969350b9538e573ac0a86f92'   where PRIMARYKEY = X'265b1618548a3074c0a86f92';
> Row 3:
>              ALIASKEY = X'94fd4d94538e5520c0a86f92'
>   BB_ACTIONDICTIONARY = CP_RECORD_DT|20141231|CP_PAY_DT|20150115|CP_FREQ|4|CP_NET_AMT|N.A.|CP_TAX_AMT| |CP_GROSS_AMT|.125|CP_FRANKED_AMT| |CP_DVD_CRNCY|USD|CP_DVD_TYP|1000|CP_SPPL_AMT| |CP_FOREIGN_AMT|N.A.|CP_PAR_PCT|N.A.|CP_STOCK_OPT|N|CP_REINVEST_RATIO| |CP_PX| |CP_TAX_RT|N.A.|CP_ADJ|0.990211|CP_ADJ_DT|20141229|CP_INDICATOR|N|CP_DVD_DRP_DISCOUNT|N.A.|CP_EUSD_TID| |CP_EUSD_TID_SW| |CP_DIST_AMT_STATUS|F|CP_NOTES|N.A.
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 100241209
>     BB_ACTIONMNEMONIC = DVD_CASH
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-12-29 00:00:00.000000'
>         BB_IDENTIFIER = CTRE    US Equity
>             BB_ISSUED = TIMESTAMP '2014-12-18 00:00:00.000000'
>          BB_NUMFIELDS = 24
>              BB_RCODE = 0
>              BB_SECID = CTRE
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-12-29 00:00:00.000000'
>            PRIMARYKEY = X'30781db254a1eafdc0a86f92'
>               VERSION = NULL
update mcorporateaction set ALIASKEY = X'969350b9538e573ac0a86f92'   where PRIMARYKEY =X'30781db254a1eafdc0a86f92';

let's see how many mtickets there are for this stockkey
select count(*) from mticket where STOCKKEY = X'b1030141537bdd22c0a86f92';
> Row 1:
>   _C001 = 7.000000

select distinct sourcekey from mticket where STOCKKEY = X'b1030141537bdd22c0a86f92';
> Row 1:
>   SOURCEKEY = NULL

only member generated trades
let's get the mtickets 

*******************************************************
> CTRE 2:
>   STOCKKEY = X'969250b9538e573ac0a86f92'
*******************************************************
select * from mstockalias where STOCKKEY = X'969250b9538e573ac0a86f92';
> Row 1:
>   CAPSECTORKEY = NULL
>          CUSIP = 14174T107
>           DATE = TIMESTAMP '2014-06-03 00:00:00.000000'
>    EXCHANGEKEY = X'9d5d2f1d390a440bc0a8015c'
>           NAME = CareTrust REIT Inc
>     PRIMARYKEY = X'969350b9538e573ac0a86f92'  <--- set the aliaskeys for the DVD_CASH to this
>       STOCKKEY = X'969250b9538e573ac0a86f92'
>         SYMBOL = CTRE
>      STATUSKEY = X'634a039339e7e928c0a801dc'
>      CSISYMBOL = NULL
>        GICSKEY = 40402045
>       STYLEKEY = XG
	select * from mcorporateaction where aliaskey=X'969350b9538e573ac0a86f92';
nothing.  I bet this came about from a spin off
select count(*) from mticket where STOCKKEY = X'969250b9538e573ac0a86f92';
> Row 1:
>   _C001 = 61.000000
select distinct sourcekey from mticket where STOCKKEY = X'969250b9538e573ac0a86f92';
> Row 1:
>   SOURCEKEY = X'6a95479a538e53e0c0a86f92'
> Row 2:
>   SOURCEKEY = NULL


we have the CA gnerated tickets and the member generated let's get a count

select count(*) from mticket where SOURCEKEY = X'6a95479a538e53e0c0a86f92';
> Row 1:
>   _C001 = 58.000000
select count(*) from mticket where STOCKKEY = X'969250b9538e573ac0a86f92' and SOURCEKEY is null;
> Row 1:
>   _C001 = 3.000000


**********  actions  ****
1.  we're keeping CTRE-2 the one from the spin off.   Move the DVD_CASH from CTRE-1 to CTRE-2
done
2.  get the mtickets for CTRE-1
select * from mticket where  STOCKKEY = X'b1030141537bdd22c0a86f92';
save these to:  CA issues CTRE 1 mtickets.txt
just curious who traded?
select distinct managerkey from mticket where  STOCKKEY = X'b1030141537bdd22c0a86f92';
> Row 1:
>   MANAGERKEY = X'4d3716e13ef5a213c0a80133'
> Row 2:
>   MANAGERKEY = X'bf4f559f3ccd5dd5c0a801e1'
select distinct loginname from mmanager where primarykey in (select  managerkey from mticket where  STOCKKEY = X'b1030141537bdd22c0a86f92');
> Row 1:
>   LOGINNAME = arrored
> Row 2:
>   LOGINNAME = fairwaypga


3.  get the ticketkeys for CTRE-1
save these to:  CA issues CTRE 1 ticketkeys to tickle.txt
select primarykey from mticket where  STOCKKEY = X'b1030141537bdd22c0a86f92';

4.  get the fundkeys for CTRE-1
save these to:  CA issues CTRE 1 fundkeys to invalidate.txt
select primarykey from mposition where STOCKKEY = X'b1030141537bdd22c0a86f92';
> Row 1:
>   PRIMARYKEY = X'2ddf159053a82d28c0a86f9c'
> Row 2:
>   PRIMARYKEY = X'4b2d66f854aedc34c0a86f9c'

select fundkey from mposition where primarykey in (select primarykey from mposition where STOCKKEY = X'b1030141537bdd22c0a86f92');
> Row 1:
>   FUNDKEY = X'e6753df052a46a8cc0a86f85'
> Row 2:
>   FUNDKEY = X'a7a057633defccaec0a80133'

just two funds easy

5.  get the mtrades for CTRE-1
save these to:  CA issues CTRE 1 mtrades to delete.txt
select * from mtrade where ticketkey in (select primarykey from mticket where  STOCKKEY = X'b1030141537bdd22c0a86f92');

6.  move the mtickets from CTRE-1 stockkey to CTRE-2 stockkey
update mticket set stockkey=X'969250b9538e573ac0a86f92'  where STOCKKEY = X'b1030141537bdd22c0a86f92';
good no more mtickets with the old stockkey

ugh - should have deleted the mtrades first
let's do one by one
> Row 1:
>                    KINDKEY = X'70593ca1391e0270c0a8015c'
>                   MATCHKEY = NULL
>                POSITIONKEY = X'2ddf159053a82d28c0a86f9c'
>                 PRIMARYKEY = X'5c27082753aafc48c0a86f9c'
>                     SHARES = 1100.000000
>                  TICKETKEY = X'dcd5058253aaea36c0a86f98'
>                     CLOSED = TIMESTAMP '2014-06-25 12:43:00.000000'
>                      PRICE = 18.344900
delete from mtrade where  PRIMARYKEY = X'5c27082753aafc48c0a86f9c';

>   CREATEDBYCORPORATEACTION = 0
> Row 2:
>                    KINDKEY = X'70563ca1391e0270c0a8015c'
>                   MATCHKEY = NULL
>                POSITIONKEY = X'2ddf159053a82d28c0a86f9c'
>                 PRIMARYKEY = X'326c159053a868e4c0a86f9c'
>                     SHARES = 270.000000
>                  TICKETKEY = X'c04f610753a86304c0a86f98'
>                     CLOSED = TIMESTAMP '2014-06-23 13:50:00.000000'
>                      PRICE = 19.074700
>   CREATEDBYCORPORATEACTION = 0
delete from mtrade where  PRIMARYKEY = X'326c159053a868e4c0a86f9c';

> Row 3:
>                    KINDKEY = X'70563ca1391e0270c0a8015c'
>                   MATCHKEY = NULL
>                POSITIONKEY = X'2ddf159053a82d28c0a86f9c'
>                 PRIMARYKEY = X'2dde159053a82d28c0a86f9c'
>                     SHARES = 160.000000
>                  TICKETKEY = X'd441318e53a8237cc0a86f98'
>                     CLOSED = TIMESTAMP '2014-06-23 09:35:00.000000'
>                      PRICE = 19.369000
>   CREATEDBYCORPORATEACTION = 0
delete from mtrade where  PRIMARYKEY = X'2dde159053a82d28c0a86f9c';

> Row 4:
>                    KINDKEY = X'70563ca1391e0270c0a8015c'
>                   MATCHKEY = NULL
>                POSITIONKEY = X'2ddf159053a82d28c0a86f9c'
>                 PRIMARYKEY = X'31ac159053a85a02c0a86f9c'
>                     SHARES = 110.000000
>                  TICKETKEY = X'4702610753a852a6c0a86f98'
>                     CLOSED = TIMESTAMP '2014-06-23 12:46:00.000000'
>                      PRICE = 19.007300
>   CREATEDBYCORPORATEACTION = 0
delete from mtrade where  PRIMARYKEY = X'31ac159053a85a02c0a86f9c';

> Row 5:
>                    KINDKEY = X'70563ca1391e0270c0a8015c'
>                   MATCHKEY = NULL
>                POSITIONKEY = X'2ddf159053a82d28c0a86f9c'
>                 PRIMARYKEY = X'102c5e0a53a9b881c0a86f9c'
>                     SHARES = 260.000000
>                  TICKETKEY = X'd33a5ad453a9b71fc0a86f98'
>                     CLOSED = TIMESTAMP '2014-06-24 13:41:00.000000'
>                      PRICE = 19.105400
>   CREATEDBYCORPORATEACTION = 0
delete from mtrade where  PRIMARYKEY = X'102c5e0a53a9b881c0a86f9c';

> Row 6:
>                    KINDKEY = X'70563ca1391e0270c0a8015c'
>                   MATCHKEY = NULL
>                POSITIONKEY = X'2ddf159053a82d28c0a86f9c'
>                 PRIMARYKEY = X'113f5e0a53a9d0d2c0a86f9c'
>                     SHARES = 300.000000
>                  TICKETKEY = X'25b25ad453a9ce1bc0a86f98'
>                     CLOSED = TIMESTAMP '2014-06-24 15:26:00.000000'
>                      PRICE = 18.908700
>   CREATEDBYCORPORATEACTION = 0
delete from mtrade where  PRIMARYKEY = X'113f5e0a53a9d0d2c0a86f9c';

> Row 7:
>                    KINDKEY = X'70563ca1391e0270c0a8015c'
>                   MATCHKEY = NULL
>                POSITIONKEY = X'4b2d66f854aedc34c0a86f9c'
>                 PRIMARYKEY = X'4b2c66f854aedc34c0a86f9c'
>                     SHARES = 5000.000000
>                  TICKETKEY = X'2ea56d4d54aebf89c0a86f98'
>                     CLOSED = TIMESTAMP '2015-01-08 14:20:55.000000'
>                      PRICE = 11.948400
>   CREATEDBYCORPORATEACTION = 0
delete from mtrade where  PRIMARYKEY = X'4b2c66f854aedc34c0a86f9c';
done

7.  tickle the tickers
X'25b25ad453a9ce1bc0a86f98'
X'2ea56d4d54aebf89c0a86f98'
X'4702610753a852a6c0a86f98'
X'c04f610753a86304c0a86f98'
X'd33a5ad453a9b71fc0a86f98'
X'd441318e53a8237cc0a86f98'
X'dcd5058253aaea36c0a86f98'
strip off the X'' 

25b25ad453a9ce1bc0a86f98
2ea56d4d54aebf89c0a86f98
4702610753a852a6c0a86f98
c04f610753a86304c0a86f98
d33a5ad453a9b71fc0a86f98
d441318e53a8237cc0a86f98
dcd5058253aaea36c0a86f98

put these in ticketstotickle file over on stocks
now run 
/Marketocracy/bin/dbtool ticklebyticket -ticketList ticketstotickle
>>>> dbtool started at 2015-01-24 10:01:54 -0500
<<<< dbtool finished at 2015-01-24 10:03:06 -0500



8.  invalidate the funds
a7a057633defccaec0a80133
e6753df052a46a8cc0a86f85

/Marketocracy/bin/fptool invalidateFund a7a057633defccaec0a80133;
/Marketocracy/bin/fptool invalidateFund e6753df052a46a8cc0a86f85;

9.  delete everything associated with CTRE-1 stockkey
> CTRE 1:
>   STOCKKEY = X'b1030141537bdd22c0a86f92'

set commit false;

delete from mstock where primarykey=  X'b1030141537bdd22c0a86f92'; 

delete from mwindowstock where stockkey=X'b1030141537bdd22c0a86f92';  

delete from mcorporateaction where aliaskey in (select primarykey from mstockalias where stockkey=X'b1030141537bdd22c0a86f92');

delete from mstockalias where stockkey=X'b1030141537bdd22c0a86f92';  

delete from mtrade where positionkey in (select primarykey from mposition where stockkey=X'b1030141537bdd22c0a86f92');   

delete from mposition where stockkey=X'b1030141537bdd22c0a86f92'; 

delete from morder where ticketkey in (select primarykey from mticket where stockkey=X'b1030141537bdd22c0a86f92');

delete from mticketallocation where ticketkey in (select primarykey from mticket where stockkey=X'b1030141537bdd22c0a86f92');

delete from mticket where stockkey=X'b1030141537bdd22c0a86f92';    

delete from GFSPOSITION where stockkey=X'b1030141537bdd22c0a86f92';  

commit;

set commit true;


let's check - how many stockkeys now? 
select distinct stockkey from mstockalias where symbol='CTRE';
> Row 1:
>   STOCKKEY = X'969250b9538e573ac0a86f92'

select * from mstockalias where STOCKKEY = X'969250b9538e573ac0a86f92';
> Row 1:
>   CAPSECTORKEY = NULL
>          CUSIP = 14174T107
>           DATE = TIMESTAMP '2014-06-03 00:00:00.000000'
>    EXCHANGEKEY = X'9d5d2f1d390a440bc0a8015c'
>           NAME = CareTrust REIT Inc
>     PRIMARYKEY = X'969350b9538e573ac0a86f92'
>       STOCKKEY = X'969250b9538e573ac0a86f92'
>         SYMBOL = CTRE
>      STATUSKEY = X'634a039339e7e928c0a801dc'
>      CSISYMBOL = NULL
>        GICSKEY = 40402045
>       STYLEKEY = XG

select * from mcorporateaction where aliaskey=X'969350b9538e573ac0a86f92';
> Row 1:
>              ALIASKEY = X'969350b9538e573ac0a86f92'
>   BB_ACTIONDICTIONARY = CP_RECORD_DT|20141031|CP_PAY_DT|20141210|CP_FREQ|N.A.|CP_NET_AMT|N.A.|CP_TAX_AMT| |CP_GROSS_AMT|5.88|CP_FRANKED_AMT| |CP_DVD_CRNCY|USD|CP_DVD_TYP|1001|CP_SPPL_AMT| |CP_FOREIGN_AMT|N.A.|CP_PAR_PCT|N.A.|CP_STOCK_OPT|S|CP_REINVEST_RATIO|N.A.|CP_PX|N.A.|CP_TAX_RT|N.A.|CP_ADJ|0.680087|CP_ADJ_DT|20141211|CP_INDICATOR|N|CP_DVD_DRP_DISCOUNT|N.A.|CP_EUSD_TID| |CP_EUSD_TID_SW| |CP_DIST_AMT_STATUS|L|CP_NOTES|The amount of cash distributed will be approximately $33.0 million, with the remainder distributed in shares
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 97615869
>     BB_ACTIONMNEMONIC = DVD_CASH
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-12-11 00:00:00.000000'
>         BB_IDENTIFIER = CTRE    US Equity
>             BB_ISSUED = TIMESTAMP '2014-10-17 00:00:00.000000'
>          BB_NUMFIELDS = 24
>              BB_RCODE = 0
>              BB_SECID = CTRE
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-12-11 00:00:00.000000'
>            PRIMARYKEY = X'265b1618548a3074c0a86f92'
>               VERSION = NULL
> Row 2:
>              ALIASKEY = X'969350b9538e573ac0a86f92'
>   BB_ACTIONDICTIONARY = CP_RECORD_DT|20141231|CP_PAY_DT|20150115|CP_FREQ|4|CP_NET_AMT|N.A.|CP_TAX_AMT| |CP_GROSS_AMT|.125|CP_FRANKED_AMT| |CP_DVD_CRNCY|USD|CP_DVD_TYP|1000|CP_SPPL_AMT| |CP_FOREIGN_AMT|N.A.|CP_PAR_PCT|N.A.|CP_STOCK_OPT|N|CP_REINVEST_RATIO| |CP_PX| |CP_TAX_RT|N.A.|CP_ADJ|0.990211|CP_ADJ_DT|20141229|CP_INDICATOR|N|CP_DVD_DRP_DISCOUNT|N.A.|CP_EUSD_TID| |CP_EUSD_TID_SW| |CP_DIST_AMT_STATUS|F|CP_NOTES|N.A.
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 100241209
>     BB_ACTIONMNEMONIC = DVD_CASH
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-12-29 00:00:00.000000'
>         BB_IDENTIFIER = CTRE    US Equity
>             BB_ISSUED = TIMESTAMP '2014-12-18 00:00:00.000000'
>          BB_NUMFIELDS = 24
>              BB_RCODE = 0
>              BB_SECID = CTRE
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-12-29 00:00:00.000000'
>            PRIMARYKEY = X'30781db254a1eafdc0a86f92'
>               VERSION = NULL


you know we didn't see where the spin off came from
select distinct sourcekey from mticket where stockkey= X'969250b9538e573ac0a86f92' and sourcekey is not null;
> Row 1:
>   SOURCEKEY = X'6a95479a538e53e0c0a86f92'

select * from mcorporateaction where primarykey in (select distinct sourcekey from mticket where stockkey= X'969250b9538e573ac0a86f92' and sourcekey is not null);
> Row 1:
>              ALIASKEY = X'e3bd645248169504c0a80146'
>   BB_ACTIONDICTIONARY = CP_SPINOFF_NAME|CareTrust REIT Inc|CP_ID_BB_COMP|37940634|CP_ID_BB_SEC|1000|CP_TERMS|1 per 1|CP_RATIO|1.000000|CP_PAY_DT|20140602|CP_RECORD_DT|20140522|CP_COST|N.A.|CP_CRNCY|USD|CP_ADJ|0.545550|CP_ADJ_DT|20140603|CP_TKR|CTRE US|CP_DUE_BILL_RED_DT|20140605|CP_SH_FRACTIONAL|1|CP_TERMS_FLAG|1|CP_INDICATOR|N|CP_SPINOFF_ID_BB_GLOBAL|BBG005KC4Z70|CP_SPINOFF_ID_BB_GLOBAL_COMPANY|BBG005KC4Z34|CP_SPINOFF_ID_BB_SEC_NUM_DES|CTRE|CP_SPINOFF_FEED_SOURCE|US|CP_NOTES|N.A.
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 83546646
>     BB_ACTIONMNEMONIC = SPIN
>          BB_COMPANYID = 11947803
>        BB_COMPANYNAME = Ensign Group Inc/The
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-06-03 00:00:00.000000'
>         BB_IDENTIFIER = ENSG    US Equity
>             BB_ISSUED = TIMESTAMP '2013-11-07 00:00:00.000000'
>          BB_NUMFIELDS = 21
>              BB_RCODE = 0
>              BB_SECID = ENSG
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-06-03 00:00:00.000000'
>            PRIMARYKEY = X'6a95479a538e53e0c0a86f92'
>               VERSION = NULL

ENSG spun off CTRE 1 to 1 ratio
pay date: 20140602
record date: 20140522
effective date: 2014-06-03

let's check one of the mmanagers who traded CTRE-1
> Row 1:
>   LOGINNAME = arrored
> Row 2:
>   LOGINNAME = fairwaypga

> Row 1:
>      ACTIONKEY = X'70563ca1391e0270c0a8015c'
>      BROKERKEY = X'2916149b39cd02dbc0a80117'
>         CLOSED = TIMESTAMP '2014-06-23 09:35:00.000000'
>        COMMENT = 
>     COMMISSION = 8.000000
>   CURRENTORDER = X'd443318e53a8237cc0a86f98'
>        LIFEKEY = X'70923ca1391e0272c0a8015c'
>           LOCK = 0
>     MANAGERKEY =X'd441318e53a8237cc0a86f98'
>       MODIFIED = NULL
>            NET = 3099.040000
>         OPENED = TIMESTAMP '2014-06-23 08:54:20.000000'
>          PRICE = 19.369000
>     PRIMARYKEY = X'd441318e53a8237cc0a86f98'
>         SECFEE = 0.000000
>         SHARES = 160.000000
>      STATUSKEY = X'708f3ca1391e0272c0a8015c'
>       STOCKKEY = X'b1030141537bdd22c0a86f92'
>      SOURCEKEY = NULL
>    NOTIFYEMAIL = NULL
select positionkey from mtrade where ticketkey=X'd441318e53a8237cc0a86f98';
> Row 1:
>   POSITIONKEY = X'816b243254c3b425c0a86f92'
select fundkey from mposition where primarykey in (select positionkey from mtrade where ticketkey=X'd441318e53a8237cc0a86f98');
> Row 1:
>   FUNDKEY = X'e6753df052a46a8cc0a86f85'
select symbol from mfund where primarykey in (select fundkey from mposition where primarykey in (select positionkey from mtrade where ticketkey=X'd441318e53a8237cc0a86f98'));
> Row 1:
>   SYMBOL = ACF

select * from mticket where PRIMARYKEY = X'd441318e53a8237cc0a86f98';
> Row 1:
>      ACTIONKEY = X'70563ca1391e0270c0a8015c'
>      BROKERKEY = X'2916149b39cd02dbc0a80117'
>         CLOSED = TIMESTAMP '2014-06-23 09:35:00.000000'
>        COMMENT = 
>     COMMISSION = 8.000000
>   CURRENTORDER = X'd443318e53a8237cc0a86f98'
>        LIFEKEY = X'70923ca1391e0272c0a8015c'
>           LOCK = 0
>     MANAGERKEY = X'4d3716e13ef5a213c0a80133'
>       MODIFIED = NULL
>            NET = 3099.040000
>         OPENED = TIMESTAMP '2014-06-23 08:54:20.000000'
>          PRICE = 19.369000
>     PRIMARYKEY = X'd441318e53a8237cc0a86f98'
>         SECFEE = 0.000000
>         SHARES = 160.000000
>      STATUSKEY = X'708f3ca1391e0272c0a8015c'
>       STOCKKEY = X'969250b9538e573ac0a86f92'
>      SOURCEKEY = NULL
>    NOTIFYEMAIL = NULL

select loginname from mmanager where primarykey=X'4d3716e13ef5a213c0a80133';
> Row 1:
>   LOGINNAME = arrored

select fundkey from mposition where primarykey in (select positionkey from mtrade where ticketkey=X'd441318e53a8237cc0a86f98');
> Row 1:
>   FUNDKEY = X'e6753df052a46a8cc0a86f85'

select symbol from mfund where primarykey in select fundkey from mposition where primarykey in ((select positionkey from mtrade where ticketkey=X'd441318e53a8237cc0a86f98'));
> Row 1:
>   SYMBOL = ACF
6/23/14 ACF fund   member arrored

LEDGER
Date	Start	Change	End	Type
Jun 23, 2014		540	540	Buy
Jun 24, 2014	540	560	1100	Buy
Jun 25, 2014	1100	-1100		Sell
Total: 0
 	 	 
 	 	
BUYS
Close Date	Quantity	Commission	Net	Price
Jun 23, 2014	160	$8.00	$3,099.04	$19.37
Jun 23, 2014	110	$5.50	$2,090.80	$19.01
Jun 23, 2014	270	$13.50	$5,150.16	$19.07
Jun 24, 2014	260	$13.00	$4,967.40	$19.11
Jun 24, 2014	300	$15.00	$5,672.60	$18.91
 	 	 
 	 	
SELLS
Close Date	Quantity	Commission	SEC Fee	Net	Price
Jun 25, 2014	1,100	$55.00	$0.36	$20,179.53	$18.35


he has trades

let's check on 1/25/15  see that CTRE shows the graph in the stock info box

1/27/15
still no graph	
select distinct stockkey from mstockalias where symbol='CTRE';
> Row 1:
>   STOCKKEY = X'969250b9538e573ac0a86f92'

select * from mstockalias where STOCKKEY = X'969250b9538e573ac0a86f92';
> Row 1:
>   CAPSECTORKEY = NULL
>          CUSIP = 14174T107
>           DATE = TIMESTAMP '2014-06-03 00:00:00.000000'
>    EXCHANGEKEY = X'9d5d2f1d390a440bc0a8015c'
>           NAME = CareTrust REIT Inc
>     PRIMARYKEY = X'969350b9538e573ac0a86f92'
>       STOCKKEY = X'969250b9538e573ac0a86f92'
>         SYMBOL = CTRE
>      STATUSKEY = X'634a039339e7e928c0a801dc'
>      CSISYMBOL = NULL
>        GICSKEY = 40402045
>       STYLEKEY = XG



select * from mcorporateaction where aliaskey=X'969350b9538e573ac0a86f92';
> Row 1:
>              ALIASKEY = X'969350b9538e573ac0a86f92'
>   BB_ACTIONDICTIONARY = CP_RECORD_DT|20141031|CP_PAY_DT|20141210|CP_FREQ|N.A.|CP_NET_AMT|N.A.|CP_TAX_AMT| |CP_GROSS_AMT|5.88|CP_FRANKED_AMT| |CP_DVD_CRNCY|USD|CP_DVD_TYP|1001|CP_SPPL_AMT| |CP_FOREIGN_AMT|N.A.|CP_PAR_PCT|N.A.|CP_STOCK_OPT|S|CP_REINVEST_RATIO|N.A.|CP_PX|N.A.|CP_TAX_RT|N.A.|CP_ADJ|0.680087|CP_ADJ_DT|20141211|CP_INDICATOR|N|CP_DVD_DRP_DISCOUNT|N.A.|CP_EUSD_TID| |CP_EUSD_TID_SW| |CP_DIST_AMT_STATUS|L|CP_NOTES|The amount of cash distributed will be approximately $33.0 million, with the remainder distributed in shares
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 97615869
>     BB_ACTIONMNEMONIC = DVD_CASH
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-12-11 00:00:00.000000'
>         BB_IDENTIFIER = CTRE    US Equity
>             BB_ISSUED = TIMESTAMP '2014-10-17 00:00:00.000000'
>          BB_NUMFIELDS = 24
>              BB_RCODE = 0
>              BB_SECID = CTRE
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-12-11 00:00:00.000000'
>            PRIMARYKEY = X'265b1618548a3074c0a86f92'
>               VERSION = NULL
> Row 2:
>              ALIASKEY = X'969350b9538e573ac0a86f92'
>   BB_ACTIONDICTIONARY = CP_RECORD_DT|20141231|CP_PAY_DT|20150115|CP_FREQ|4|CP_NET_AMT|N.A.|CP_TAX_AMT| |CP_GROSS_AMT|.125|CP_FRANKED_AMT| |CP_DVD_CRNCY|USD|CP_DVD_TYP|1000|CP_SPPL_AMT| |CP_FOREIGN_AMT|N.A.|CP_PAR_PCT|N.A.|CP_STOCK_OPT|N|CP_REINVEST_RATIO| |CP_PX| |CP_TAX_RT|N.A.|CP_ADJ|0.990211|CP_ADJ_DT|20141229|CP_INDICATOR|N|CP_DVD_DRP_DISCOUNT|N.A.|CP_EUSD_TID| |CP_EUSD_TID_SW| |CP_DIST_AMT_STATUS|F|CP_NOTES|N.A.
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 100241209
>     BB_ACTIONMNEMONIC = DVD_CASH
>          BB_COMPANYID = 37940634
>        BB_COMPANYNAME = CareTrust REIT Inc
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-12-29 00:00:00.000000'
>         BB_IDENTIFIER = CTRE    US Equity
>             BB_ISSUED = TIMESTAMP '2014-12-18 00:00:00.000000'
>          BB_NUMFIELDS = 24
>              BB_RCODE = 0
>              BB_SECID = CTRE
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-12-29 00:00:00.000000'
>            PRIMARYKEY = X'30781db254a1eafdc0a86f92'
>               VERSION = NULL

so CTRE was a spin off
select distinct sourcekey from mticket where stockkey=X'969250b9538e573ac0a86f92';
> Row 1:
>   SOURCEKEY = X'6a95479a538e53e0c0a86f92'
> Row 2:
>   SOURCEKEY = NULL

select * from mcorporateaction where primarykey=X'6a95479a538e53e0c0a86f92';
> Row 1:
>              ALIASKEY = X'e3bd645248169504c0a80146'
>   BB_ACTIONDICTIONARY = CP_SPINOFF_NAME|CareTrust REIT Inc|CP_ID_BB_COMP|37940634|CP_ID_BB_SEC|1000|CP_TERMS|1 per 1|CP_RATIO|1.000000|CP_PAY_DT|20140602|CP_RECORD_DT|20140522|CP_COST|N.A.|CP_CRNCY|USD|CP_ADJ|0.545550|CP_ADJ_DT|20140603|CP_TKR|CTRE US|CP_DUE_BILL_RED_DT|20140605|CP_SH_FRACTIONAL|1|CP_TERMS_FLAG|1|CP_INDICATOR|N|CP_SPINOFF_ID_BB_GLOBAL|BBG005KC4Z70|CP_SPINOFF_ID_BB_GLOBAL_COMPANY|BBG005KC4Z34|CP_SPINOFF_ID_BB_SEC_NUM_DES|CTRE|CP_SPINOFF_FEED_SOURCE|US|CP_NOTES|N.A.
>         BB_ACTIONFLAG = U
>           BB_ACTIONID = 83546646
>     BB_ACTIONMNEMONIC = SPIN
>          BB_COMPANYID = 11947803
>        BB_COMPANYNAME = Ensign Group Inc/The
>           BB_CURRENCY = USD
>          BB_EFFECTIVE = TIMESTAMP '2014-06-03 00:00:00.000000'
>         BB_IDENTIFIER = ENSG    US Equity
>             BB_ISSUED = TIMESTAMP '2013-11-07 00:00:00.000000'
>          BB_NUMFIELDS = 21
>              BB_RCODE = 0
>              BB_SECID = ENSG
>          BB_SECIDTYPE = TKR
>         BB_SECURITYID = 1000
>            BB_UPDATED = TIMESTAMP '2014-06-03 00:00:00.000000'
>            PRIMARYKEY = X'6a95479a538e53e0c0a86f92'
>               VERSION = NULL

it was a 1 for 1 spin off from ENSG CP_PAY_DT|20140602


check MAdmin
Stock:CareTrust REIT Inc  Symbol:CTRE
Date: 01/27/2015

38 users found

1	aimanagellc	arogolsky	billmaples	cchin	chris_nairn	clarkrl2	cvantoor	dchabino	dhess0	e_levy
2	eckiecki2002	fairwaypga	fedge	gbravo	ggurley	grand-pas	gwright64	haascap	horsepowerdude	jawright
3	jfrancois	jfrog	kames	kopprasch	kstavrou	kwade	marcl	plundstedt001	qpr	rancid514
4	reveille	scary	sombrehombre	stanglx718	syphrix	valuestocks	vsagdeo	wshaw1288

let's try doing a sample buy - entered a buy  

looking at jfancois BETA
LEDGER
Date	Start	Change	End	Type
Jun 02, 2014		-37364	-37364	Corporate Action
Total: -37364

ok on 6/2/14 he had -37364 in his BETA fund (short fund) so he also went short by -37364 in CTRE - ok

have to look into the graph and prices

revisiting this one  2/3/15

let's see what we have in the database
select distinct stockkey from mstockalias where symbol='CTRE';
> Row 1:
>   STOCKKEY = X'969250b9538e573ac0a86f92'
select * from mstockalias where STOCKKEY = X'969250b9538e573ac0a86f92';
> Row 1:
>   CAPSECTORKEY = NULL
>          CUSIP = 14174T107
>           DATE = TIMESTAMP '2014-06-03 00:00:00.000000'
>    EXCHANGEKEY = X'9d5d2f1d390a440bc0a8015c'
>           NAME = CareTrust REIT Inc
>     PRIMARYKEY = X'969350b9538e573ac0a86f92'
>       STOCKKEY = X'969250b9538e573ac0a86f92'
>         SYMBOL = CTRE
>      STATUSKEY = X'634a039339e7e928c0a801dc'
>      CSISYMBOL = NULL
>        GICSKEY = 40402045
>       STYLEKEY = XG

still trades
are we getting a graph?
yes.  I wonder if there are prices missing

who holds this?
Stock:CareTrust REIT Inc  Symbol:CTRE
Date: 02/03/2015

40 users found

1	aimanagellc	arogolsky	billmaples	cchin	chris_nairn	clarkrl2	cvantoor	dchabino	dhess0	e_levy
2	eckiecki2002	fairwaypga	fedge	gbravo	ggurley	grand-pas	gwright64	haascap	headhunter	horsepowerdude
3	jawright	jfrancois	jfrog	kames	kopprasch	kstavrou	kwade	marcl	martyfukui	plundstedt001
4	qpr	rancid514	reveille	scary	sombrehombre	stanglx718	syphrix	valuestocks	vsagdeo	wshaw1288	 	 	 	 	 	 	 	 	 	 

let's try chris_nairn
 your holdings of CTRE	
 	 	
Fund	Shares	Value	Portion of fund
CMF	200	 $2,916.00	 0.09%  <--- expand
SHORT	 0	 N/A	 N/A
focus	 0	 N/A	 N/A

LEDGER
Date	Start	Change	End	Type
Jun 02, 2014		200	200	Corporate Action
Total: 20


/Marketocracy/Scripts/stocks/daily/stock-price-importer.rb -s CTRE -b 20140603 -e 20150202
got failuers




let's go back to the bloomberg one
 /Marketocracy/Scripts/stocks/daily/stock-price-importer-bloomberg.rb -h
Usage: stock-price-importer-bloomberg [options]

Options:
    -n                                --norun
                                     Don't apply database changes.
    -s [SYMBOL]                       --symbol [SYMBOL]
                                     Import SYMBOL only
    -v                                --verbose
                                     Verbose mode
    -b BEGINDATE                      --date BEGINDATE
                                     Set the start date for the import
    -e ENDDATE                        --endDate ENDDATE
                                     Set the end date for the import
    -h, --help                       Show this help

 /Marketocracy/Scripts/stocks/daily/stock-price-importer-bloomberg.rb -s CTRE -b 20140603 -e 20150202
2/4/15

let's see who holds CTRE on 06/03/2014
Stock:CareTrust REIT Inc  Symbol:CTRE
Date: 06/03/2014

40 users found

1	aimanagellc	arogolsky	billmaples	boyplunger	cchin	chris_nairn	clarkrl2	cvantoor	dchabino	deepsilver
2	dhess0	e_levy	eckiecki2002	fedge	gbravo	ggurley	grand-pas	gwright64	haascap	horsepowerdude
3	jawright	jfrancois	jfrog	kames	kopprasch	kstavrou	kwade	marcl	plundstedt001	qpr
4	rancid514	reveille	rjeddings	scary	sombrehombre	stanglx718	syphrix	valuestocks	vsagdeo	wshaw1288

check jfrancois   portfolioAdmin is down, have to use reg Portfolio  retrieve the passwprd for him
/Marketocracy/bin/dbtool decryptpassword -loginName jfrancois
Password = haiti1804  

CTTE in his BETA fund on 6/3/14 still not pricing
we didn't do the force of the reprice.
we repriced for ATK, hold one what was that date?

/Marketocracy/bin/StockPriceBuilder invalidate 2014-06-03

ok check again on 2/5/15 
jfrancois  BETA on 6/3/14

